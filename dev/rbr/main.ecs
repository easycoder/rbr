!   main.ecs - the main program script


    dictionary Map
    dictionary Profile
    dictionary Room
    dictionary RoomState
    dictionary Request
    list Profiles
    list Rooms
    list RoomStates
    module DeviceModule
    module UI
    variable RoomCount
    variable CurrentProfile
    variable R

    load Map from `../map.json`
    put entry `profiles` of Map into Profiles
    put entry `profile` of Map into CurrentProfile
    put item CurrentProfile of Profiles into Profile
    put entry `rooms` of Profile into Rooms
    put the count of Rooms into RoomCount
    set the elements of DeviceModule to RoomCount

    ! Set up the room states variable
    reset RoomStates
    reset RoomState
    put 0 into R
    while R is less than the count of Rooms
    begin
        append RoomState to RoomStates
        increment R
    end

    ! Launch a module for each room
    put 0 into R
    while R is less than the count of Rooms
    begin
        put item R of Rooms into Room
        put item R of RoomStates into RoomState
        index DeviceModule to R
        run `devices.ecs` as DeviceModule with Room and RoomState
        increment R
    end

    ! Launch the UI
    run `ui.ecs` as UI with Map and Request

    log `All set up and ready`
    stop
