#!/bin/sh

adduser pi

read -p "Please repeat your password: " password
echo "pi:$password" | chpasswd
echo "$password" > /home/pi/mypass
chown -R pi /home/pi/mypass
echo "wlan0" > /home/pi/network
chown -R pi /home/pi/network

deluser orangepi
rm -rf /home/orangepi

echo "root:$password" | chpasswd

apt update
apt -y full-upgrade

echo "Install Python Pip"
apt install -y python3-pip
echo "Install bottle and requests"
runuser -l pi -c "pip3 install pytz bottle requests"
echo "Get the resource pack"
runuser -l pi -c "wget https://rbrheating.com/resources/rbr.tgz"
echo "Unpack resources"
runuser -l pi -c "tar zxf rbr.tgz"
echo "Remove the resource pack"
runuser -l pi -c "rm rbr.tgz"
echo "Save the IP address"
runuser -l pi -c "ip -f inet addr show wlan0 | grep -Po 'inet \K[\d.]+' >ip"
echo "Set up cron"
runuser -l pi -c "crontab pi_cron"
echo "Now reboot the Orange Pi and log in again as 'pi' with your chosen password"
